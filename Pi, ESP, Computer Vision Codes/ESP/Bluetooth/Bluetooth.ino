#include "BluetoothSerial.h" // Library for Bluetooth communication

BluetoothSerial SerialBT;    // Bluetooth object
String device_name = "ESP32-BT"; // Bluetooth device name
String dataset = "1,2,3,5|4,5,6,8|7,8,9,12|10,11,12,16|13,14,15,19|16,17,18,23|19,20,21,28|22,23,24,30|25,26,27,34|28,29,30,37|31,32,33,42|34,35,36,45|37,38,39,50|40,41,42,55|43,44,45,60|46,47,48,63|49,50,51,67|52,53,54,70|55,56,57,75|58,59,60,79|61,62,63,84|64,65,66,88|67,68,69,93|70,71,72,98|73,74,75,104|76,77,78,109|79,80,81,114|82,83,84,119|85,86,87,124|88,89,90,128|91,92,93,133|94,95,96,137|97,98,99,141|100,101,102,147|103,104,105,152|106,107,108,158|109,110,111,162|112,113,114,167|115,116,117,172|118,119,120,178|121,122,123,183|124,125,126,189|127,128,129,193|130,131,132,198|133,134,135,204|136,137,138,208|139,140,141,213|142,143,144,218|145,146,147,223|148,149,150,229|151,152,153,234|154,155,156,240|157,158,159,245|160,161,162,249|163,164,165,255|166,167,168,261|169,170,171,266|172,173,174,272|175,176,177,276|178,179,180,282|181,182,183,287|184,185,186,292|187,188,189,298|190,191,192,303|193,194,195,307|196,197,198,312|199,200,201,317|202,203,204,323|205,206,207,327|208,209,210,332|211,212,213,337|214,215,216,343|217,218,219,348|220,221,222,354|223,224,225,358|226,227,228,363|229,230,231,368|232,233,234,373|235,236,237,378|238,239,240,384|241,242,243,389|244,245,246,394|247,248,249,399|250,251,252,404|253,254,255,409|256,257,258,415|259,260,261,420|262,263,264,425|265,266,267,430|268,269,270,436|271,272,273,441|274,275,276,446|277,278,279,451|280,281,282,457|283,284,285,462|286,287,288,467|289,290,291,472|292,293,294,478|295,296,297,483|298,299,300,488";

void setup() {
  SerialBT.begin(device_name);         // Initialize Bluetooth with the device name
  Serial.begin(115200);                // Initialize serial communication
}

void loop() {
  // Bluetooth communication: check if data is received via Bluetooth
  if (SerialBT.available()) {
    String incomingData = SerialBT.readStringUntil('\n');
    incomingData.trim();
    
    // If the received data is "a", send the elapsed time and dataset
    if (incomingData == "a") {
      long t = millis();  // Calculate the elapsed time
      Serial.println(t);
      
      // Send the elapsed time
      SerialBT.println(t);

      // Send the dataset 
      SerialBT.println(dataset);
    }
  }
}

